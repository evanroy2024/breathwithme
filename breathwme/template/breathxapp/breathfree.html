<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>WebToNative Haptic Test</title>
</head>
<body>
  <button id="haptic" style="padding:20px; font-size:20px;">WTN HAPTIC</button>
  <div id="log"></div>

  <script>
    // Load WTN SDK with better error handling
    function loadWTNSDK() {
      return new Promise((resolve, reject) => {
        const script = document.createElement('script');
        script.src = 'https://app.webtonative.com/sdk.js';
        script.onload = () => {
          addLog('‚úÖ WTN SDK script loaded');
          // Wait a bit for WTN to initialize
          setTimeout(() => {
            if (window.WTN) {
              addLog('‚úÖ WTN object available');
              resolve();
            } else {
              addLog('‚ùå WTN object not found after script load');
              reject('WTN object not initialized');
            }
          }, 500);
        };
        script.onerror = () => {
          addLog('‚ùå Failed to load WTN SDK script');
          reject('Script load failed');
        };
        document.head.appendChild(script);
      });
    }
  </script>
  
  <script>
    let log = document.getElementById('log');
    
    function addLog(msg) {
      log.innerHTML += '<br>' + new Date().toLocaleTimeString() + ': ' + msg;
    }
    
    // Check if WTN loaded
    function checkWTN() {
      if (window.WTN) {
        addLog('‚úÖ WTN SDK loaded');
        if (window.WTN.haptics) {
          addLog('‚úÖ WTN haptics available');
        } else {
          addLog('‚ùå WTN haptics not available');
        }
      } else {
        addLog('‚ùå WTN SDK not loaded');
      }
    }
    
    document.getElementById('haptic').onclick = function() {
      addLog('Testing WTN haptic...');
      
      if (!window.WTN) {
        addLog('‚ùå WTN not loaded - check internet connection');
        return;
      }
      
      if (!window.WTN.haptics) {
        addLog('‚ùå WTN haptics not available - check app configuration');
        return;
      }
      
      // Try all WTN haptic effects
      let effects = [
        'impactLight',
        'impactMedium', 
        'impactHeavy',
        'notificationSuccess',
        'notificationWarning',
        'notificationError',
        'selectionChanged'
      ];
      
      effects.forEach((effect, i) => {
        setTimeout(() => {
          try {
            window.WTN.haptics.trigger({ effect: effect });
            addLog('‚úÖ Triggered: ' + effect);
          } catch (error) {
            addLog('‚ùå Failed ' + effect + ': ' + error.message);
          }
        }, i * 500);
      });
      
      // Also try with duration
      setTimeout(() => {
        try {
          window.WTN.haptics.trigger({ 
            effect: 'impactHeavy',
            duration: 1000 
          });
          addLog('‚úÖ Triggered heavy with duration');
        } catch (error) {
          addLog('‚ùå Duration failed: ' + error.message);
        }
      }, effects.length * 500);
    };
    
    // Check if running in WebToNative app
    const userAgent = navigator.userAgent;
    const platform = navigator.platform;
    
    if (platform === 'Win32' || platform.includes('Mac') || platform.includes('Linux')) {
      addLog('üö´ RUNNING ON DESKTOP - WTN ONLY WORKS ON MOBILE APP!');
      addLog('üì± Deploy to WebToNative mobile app to test haptics');
      addLog('üíª Desktop browsers do not support WebToNative SDK');
      return;
    }
    
    if (!userAgent.includes('WebToNative') && !userAgent.includes('wvt')) {
      addLog('‚ö†Ô∏è May not be running in WebToNative app');
      addLog('üëÄ User Agent: ' + userAgent);
    }
    
    // Load and test WTN SDK
    addLog('Loading WTN SDK...');
    loadWTNSDK()
      .then(() => {
        checkWTN();
        
        // Auto-test
        setTimeout(() => {
          if (window.WTN && window.WTN.haptics) {
            addLog('Auto-testing medium impact...');
            try {
              window.WTN.haptics.trigger({ effect: 'impactMedium' });
              addLog('‚úÖ Auto-test sent');
            } catch (error) {
              addLog('‚ùå Auto-test failed: ' + error.message);
            }
          }
        }, 1000);
      })
      .catch((error) => {
        addLog('‚ùå WTN SDK load failed: ' + error);
        addLog('üí° Possible solutions:');
        addLog('1. Check if running inside WebToNative app (not browser)');
        addLog('2. Check internet connection');
        addLog('3. Try different network/WiFi');
        addLog('4. Check if WebToNative server is down');
        addLog('5. Use local SDK file instead of CDN');
        
        // Try fallback URL
        addLog('Trying fallback SDK URL...');
        const fallbackScript = document.createElement('script');
        fallbackScript.src = 'https://cdn.jsdelivr.net/gh/webtonative/sdk@latest/dist/sdk.js';
        fallbackScript.onload = () => addLog('‚úÖ Fallback SDK loaded');
        fallbackScript.onerror = () => addLog('‚ùå Fallback SDK also failed');
        document.head.appendChild(fallbackScript);
      });
    
    // Debug info
    window.addEventListener('load', () => {
      setTimeout(() => {
        addLog('--- DEBUG INFO ---');
        addLog('User Agent: ' + navigator.userAgent.substring(0, 50) + '...');
        addLog('Platform: ' + navigator.platform);
        addLog('WTN Object: ' + (window.WTN ? 'Present' : 'Missing'));
        if (window.WTN) {
          addLog('WTN Keys: ' + Object.keys(window.WTN).join(', '));
        }
      }, 3000);
    });
  </script>
</body>
</html>