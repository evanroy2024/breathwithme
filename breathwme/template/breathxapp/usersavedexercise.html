{% extends "base.html" %} 

{% block content %}
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">

<style>
    body {
        background-color: #121212;
        color: #e0e0e0;
    }

    .bg-light, .card, .card-body {
        background-color: #1e1e1e !important;
        color: #fff;
        border: 1px solid #333;
    }

    .search-box, .filter-badge {
        background-color: #333;
        color: #ddd;
        border: 1px solid #555;
    }

    .search-box input {
        background: transparent;
        color: #fff;
    }

    .search-box input::placeholder, .activity-date {
        color: #bbb;
    }

    .filter-badge:hover, .filter-badge.active {
        background-color: #007bff;
        color: white;
    }

    .activity-item {
        background-color: #282828;
        border: 1px solid #3a3a3a;
        color: #fff;
        padding: 1.5rem;
        border-radius: 12px;
        transition: all 0.3s ease;
        margin-bottom: 1rem;
    }

    .activity-item:hover {
        background-color: #333;
        transform: translateX(5px);
    }

    .activity-icon {
        background-color: #007bff;
        color: white;
        width: 40px;
        height: 40px;
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .progress {
        background-color: #444;
    }

    .progress-bar {
        background-color: #0d6efd;
    }

    .btn-primary {
        background-color: #0d6efd;
        border-color: #0d6efd;
    }

    .btn-primary:hover {
        background-color: #0056b3;
        border-color: #004494;
    }
</style>
<div class="">
    <div class="py-3">
        <div class="row justify-content-center">
            <div class="col-lg-10">
                <div class="card border-0 shadow-sm">
                    <div class="card-body p-4">
                        <div class="mb-4">
                            <!-- Top Row: Header and Admin/MyList buttons -->
                            <div class="d-flex justify-content-between align-items-center mb-4">
                                <!-- Left Side: Text -->
                                <h4 class="mb-0 fw-bold">Silent Saved Exercises</h4>
                            
                                <!-- Right Side: Secondary Buttons -->
                               
                            </div>
                            
                            <!-- Premium Feature Container -->
                            <div class="premium-feature-container">
                               
                                
                                <!-- Main BreathFree button container - reduced height -->
                                <div class="breathfree-container">
                                    <!-- Light beams -->
                                    <div class="light-beam light-beam-1"></div>
                                    <!-- <div class="light-beam light-beam-2"></div> -->
                                    
                                    <!-- Animated border -->
                                    <div class="animated-border-container">
                                        <div class="animated-border"></div>
                                    </div>
                                    
                                    <!-- Main button -->
                                    <a href="{% url 'breathxapp:breathfree' %}" class="breathfree-premium-btn">
                                        <div class="btn-left">
                                            <!-- Animated icon container -->
                                            <div class="icon-orbit">
                                                <div class="icon-particle icon-particle-1"></div>
                                                <div class="icon-particle icon-particle-2"></div>
                                                <div class="icon-center">
                                                    <i class="fas fa-wind"></i>
                                                </div>
                                            </div>
                                            
                                            <!-- Text content -->
                                            <div class="btn-text-content">
                                                <h3 class="btn-title">BreatheFree</h3>
                                                <p class="btn-subtitle">Discover your perfect breathing exercise</p>
                                            </div>
                                        </div>
                                        
                                        <!-- Call to action -->
                                        <div class="btn-cta">
                                            <span class="cta-text">START NOW</span>
                                            <span class="cta-arrow">
                                                <i class="fas fa-long-arrow-alt-right"></i>
                                            </span>
                                        </div>
                                    </a>
                                    
                                    <!-- Focus indicators -->
                                    <div class="focus-dot focus-dot-1"></div>
                                    <div class="focus-dot focus-dot-2"></div>
                                    <div class="focus-dot focus-dot-3"></div>
                                    <div class="focus-dot focus-dot-4"></div>
                                </div>
                                
                            </div>
                             <div class="d-flex align-items-center" style="margin-top: 1%;" id="list-buttons">
                                    <a href="{% url 'breathxapp:exercise_list' %}" class="btn btn-outline-danger px-3 py-2 fw-bold me-2">
                                        <i class="fas fa-bookmark me-2"></i> Admin
                                    </a>
                            
                                    <a href="{% url 'breathxapp:usersavedexercise' %}" class="btn btn-outline-success px-3 py-2 fw-bold">
                                        <i class="fas fa-bookmark me-2"></i> MyList
                                    </a>
                                    <button id="toggleStarredBtn" class="btn btn-outline-warning px-3 py-2 fw-bold ms-2">
                                    <i class="fas fa-star me-2"></i> Starred
                                    </button>
                                </div>
                        </div>
                        
                        <!-- Add this to your CSS -->
                        <style>
                            /* Premium feature container */
                            .premium-feature-container {
                                position: relative;
                                margin: 25px 0 15px;
                            }
                            
                            /* Premium badge - centered */
                            .premium-badge {
                                position: absolute;
                                top: -15px;
                                left: 50%;
                                transform: translateX(-50%);
                                background: linear-gradient(135deg, #ffd700, #ff8c00);
                                color: #fff;
                                padding: 5px 15px;
                                border-radius: 30px;
                                font-size: 0.75rem;
                                font-weight: 700;
                                letter-spacing: 0.5px;
                                z-index: 10;
                                box-shadow: 0 4px 10px rgba(255, 193, 7, 0.4);
                                display: flex;
                                align-items: center;
                            }
                            
                            .badge-icon {
                                margin-right: 5px;
                                animation: crown-shine 2s infinite;
                            }
                            
                            @keyframes crown-shine {
                                0%, 100% { transform: scale(1); opacity: 1; }
                                50% { transform: scale(1.2); opacity: 0.8; }
                            }
                            
                            /* Container for the button - reduced height */
                            .breathfree-container {
                                position: relative;
                                width: 100%;
                                height: 90px; /* Reduced from 110px */
                                margin-bottom: 10px;
                                isolation: isolate;
                            }
                            
                            /* Light beams */
                            .light-beam {
                                position: absolute;
                                height: 400%;
                                width: 100px;
                                background: linear-gradient(rgba(78, 115, 223, 0), rgba(78, 115, 223, 0.1), rgba(78, 115, 223, 0));
                                top: -150%;
                                z-index: 1;
                                transform: rotate(45deg);
                            }
                            
                            .light-beam-1 {
                                left: -50px;
                                animation: beam-move-1 8s infinite linear;
                            }
                            
                            .light-beam-2 {
                                right: -50px;
                                animation: beam-move-2 12s infinite linear;
                            }
                            
                            @keyframes beam-move-1 {
                                0% { left: -150px; }
                                100% { left: 100%; }
                            }
                            
                            @keyframes beam-move-2 {
                                0% { right: -150px; }
                                100% { right: 100%; }
                            }
                            
                            /* Animated border */
                            .animated-border-container {
                                position: absolute;
                                inset: -3px;
                                border-radius: 15px;
                                padding: 3px;
                                overflow: hidden;
                                z-index: 2;
                            }
                            
                            .animated-border {
                                position: absolute;
                                inset: 0;
                                border-radius: 15px;
                                background: linear-gradient(90deg, 
                                    #4e73df, #2242a8, #4f46e5, #4e73df);
                                background-size: 400% 400%;
                                animation: border-slide 4s linear infinite;
                            }
                            
                            @keyframes border-slide {
                                0% { background-position: 0% 50%; }
                                100% { background-position: 400% 50%; }
                            }
                            
                            /* Main button styling */
                            .breathfree-premium-btn {
                                position: absolute;
                                display: flex;
                                justify-content: space-between;
                                align-items: center;
                                width: 100%;
                                height: 100%;
                                padding: 12px 25px;
                                background: linear-gradient(135deg, #4e73df, #1e3a8a);
                                border-radius: 12px;
                                text-decoration: none;
                                color: white;
                                box-shadow: 
                                    0 10px 25px rgba(78, 115, 223, 0.5),
                                    inset 0 1px 1px rgba(255, 255, 255, 0.3);
                                z-index: 5;
                                overflow: hidden;
                                transition: all 0.3s ease;
                            }
                            
                            .breathfree-premium-btn:hover {
                                transform: translateY(-5px);
                                box-shadow: 
                                    0 15px 30px rgba(78, 115, 223, 0.6),
                                    inset 0 1px 1px rgba(255, 255, 255, 0.3);
                            }
                            
                            .breathfree-premium-btn:active {
                                transform: translateY(2px);
                                box-shadow: 
                                    0 5px 15px rgba(78, 115, 223, 0.4),
                                    inset 0 1px 1px rgba(255, 255, 255, 0.3);
                            }
                            
                            /* Left side of button */
                            .btn-left {
                                display: flex;
                                align-items: center;
                            }
                            
                            /* Icon orbit styling - slightly reduced */
                            .icon-orbit {
                                position: relative;
                                width: 50px; /* Reduced from 60px */
                                height: 50px; /* Reduced from 60px */
                                margin-right: 18px;
                            }
                            
                            .icon-center {
                                position: absolute;
                                top: 50%;
                                left: 50%;
                                transform: translate(-50%, -50%);
                                width: 38px; /* Reduced from 46px */
                                height: 38px; /* Reduced from 46px */
                                background: rgba(255, 255, 255, 0.15);
                                border-radius: 50%;
                                display: flex;
                                justify-content: center;
                                align-items: center;
                                z-index: 2;
                                box-shadow: 0 0 20px rgba(255, 255, 255, 0.5);
                            }
                            
                            .icon-center i {
                                font-size: 1.3rem; /* Reduced from 1.5rem */
                                color: white;
                            }
                            
                            .icon-particle {
                                position: absolute;
                                width: 8px; /* Reduced from 10px */
                                height: 8px; /* Reduced from 10px */
                                background: white;
                                border-radius: 50%;
                                top: 50%;
                                left: 50%;
                                transform-origin: 25px 0; /* Reduced from 30px */
                                box-shadow: 0 0 10px rgba(255, 255, 255, 0.8);
                            }
                            
                            .icon-particle-1 {
                                animation: orbit 4s linear infinite;
                            }
                            
                            .icon-particle-2 {
                                width: 5px; /* Reduced from 6px */
                                height: 5px; /* Reduced from 6px */
                                animation: orbit 6s linear infinite reverse;
                            }
                            
                            @keyframes orbit {
                                0% { transform: rotate(0deg) translateX(25px) rotate(0deg); } /* Reduced from 30px */
                                100% { transform: rotate(360deg) translateX(25px) rotate(-360deg); } /* Reduced from 30px */
                            }
                            
                            /* Text content - slightly reduced */
                            .btn-text-content {
                                display: flex;
                                flex-direction: column;
                            }
                            
                            .btn-title {
                                font-size: 1.4rem; /* Reduced from 1.6rem */
                                font-weight: 700;
                                margin: 0 0 2px 0;
                                background: linear-gradient(90deg, #ffffff, #e6e9ff);
                                -webkit-background-clip: text;
                                background-clip: text;
                                color: transparent;
                            }
                            
                            .btn-subtitle {
                                font-size: 0.85rem; /* Reduced from 0.9rem */
                                margin: 0;
                                opacity: 0.9;
                            }
                            
                            /* Call to action - slightly reduced */
                            .btn-cta {
                                display: flex;
                                align-items: center;
                                background: rgba(255, 255, 255, 0.2);
                                padding: 8px 16px; /* Reduced from 10px 20px */
                                border-radius: 30px;
                                transition: all 0.3s ease;
                            }
                            
                            .cta-text {
                                font-weight: 700;
                                font-size: 0.85rem; /* Reduced from 0.9rem */
                                letter-spacing: 0.5px;
                                margin-right: 10px;
                            }
                            
                            .cta-arrow {
                                animation: arrow-pulse 1.5s infinite;
                            }
                            
                            @keyframes arrow-pulse {
                                0%, 100% { transform: translateX(0); }
                                50% { transform: translateX(5px); }
                            }
                            
                            .breathfree-premium-btn:hover .btn-cta {
                                background: rgba(255, 255, 255, 0.3);
                            }
                            
                            /* Focus indicator dots */
                            .focus-dot {
                                position: absolute;
                                width: 6px; /* Reduced from 8px */
                                height: 6px; /* Reduced from 8px */
                                background: #4e73df;
                                border-radius: 50%;
                                z-index: 3;
                            }
                            
                            .focus-dot-1 {
                                top: -3px;
                                left: 30px;
                                animation: pulse-dot 2s infinite ease-in-out;
                            }
                            
                            .focus-dot-2 {
                                top: -3px;
                                right: 30px;
                                animation: pulse-dot 2s infinite ease-in-out 0.5s;
                            }
                            
                            .focus-dot-3 {
                                bottom: -3px;
                                left: 30px;
                                animation: pulse-dot 2s infinite ease-in-out 1s;
                            }
                            
                            .focus-dot-4 {
                                bottom: -3px;
                                right: 30px;
                                animation: pulse-dot 2s infinite ease-in-out 1.5s;
                            }
                            
                            @keyframes pulse-dot {
                                0%, 100% { transform: scale(1); opacity: 0.7; }
                                50% { transform: scale(1.5); opacity: 1; }
                            }
                            
                            /* Info hint */
                            .info-hint {
                                display: flex;
                                justify-content: center;
                                align-items: center;
                                color: #6c757d;
                                font-size: 0.85rem;
                                margin-top: 10px; /* Reduced from 12px */
                            }
                            
                            .info-hint i {
                                margin-right: 5px;
                                color: #4e73df;
                            }
                            
                            /* Add wave effect */
                            .breathfree-premium-btn:after {
                                content: '';
                                position: absolute;
                                top: -50%;
                                left: -50%;
                                width: 200%;
                                height: 200%;
                                background: radial-gradient(
                                    circle,
                                    rgba(255, 255, 255, 0.1) 0%,
                                    rgba(255, 255, 255, 0) 70%
                                );
                                opacity: 0;
                                z-index: 1;
                                animation: ripple 4s infinite;
                            }
                            
                            @keyframes ripple {
                                0% {
                                    transform: scale(0.3);
                                    opacity: 0;
                                }
                                50% {
                                    opacity: 0.2;
                                }
                                100% {
                                    transform: scale(1);
                                    opacity: 0;
                                }
                            }
                        </style>
                        
                        

                        <!-- Search and Filter -->
                        <div class="row g-3 mb-4">
                            <div>
                                <div class="search-box d-flex align-items-center p-2 rounded">
                                    <i class="fas fa-search text-muted me-2"></i>
                                    <input type="text" id="searchInput" class="border-0 w-100" placeholder="Search exercises..." onkeyup="filterExercises()">
                                </div>
                            </div>
                        </div>


                        <!-- Saved Exercises List -->
                        <div class="activity-timeline" id="exerciseList">
    {% for exercise in exercises %}
    <div class="activity-item" data-name="{{ exercise.nickname|lower }}">
        <div class="d-flex gap-3 align-items-start">
            <div class="activity-icon">
                <i class="fas fa-dumbbell"></i>
            </div>
            <div class="flex-grow-1 w-100">
                <!-- Name + Star in one tight inline-flex box -->
                <div class="mb-1 w-100">
                   <div class="d-flex align-items-center text-light" style="flex-wrap: nowrap; white-space: nowrap;">
    <h6 class="mb-0 me-2" style="margin: 0; white-space: nowrap;">{{ exercise.nickname }}</h6>
    <form method="post" class="star-form" data-id="{{ exercise.id }}" style="margin: 0; flex-shrink: 0;">
        {% csrf_token %}
       <button type="button"
    class="star-toggle-btn"
    data-starred="{{ exercise.starred|yesno:'true,false' }}"
    style="background: none; border: none; padding: 0; font-size: 20px; cursor: pointer; color: white;">
    {% if exercise.starred %}
        <i class="fas fa-star" style="color: yellow;"></i>
    {% else %}
        <span style="font-size: 20px;">☆</span>
    {% endif %}
</button>

    </form>
</div>

                </div>
                <!-- Shape & Timing -->
                <div class="mb-2">
                    <span class="activity-date text-light text-break d-block">
                        {{ exercise.shape|capfirst }} [
                        {% if exercise.shape == "triangle" or exercise.shape == "reverseTriangle" %}
                            {% for val in exercise.inputs|slice:":3" %}
                                {{ val }}{% if not forloop.last %}, {% endif %}
                            {% endfor %}
                        {% elif exercise.shape == "oval" or exercise.shape == "circle" %}
                            {% for val in exercise.inputs|slice:":2" %}
                                {{ val }}{% if not forloop.last %}, {% endif %}
                            {% endfor %}
                        {% else %}
                            {% for val in exercise.inputs %}
                                {{ val }}{% if not forloop.last %}, {% endif %}
                            {% endfor %}
                        {% endif %}
                        ]
                    </span>
                </div>
                <!-- Buttons: Play + Delete always inline -->
                <div class="d-flex justify-content-between align-items-center gap-2">
                    <a href="{% url 'breathxapp:view_saved_exercise' exercise.id %}"
                        class="btn btn-primary btn-sm flex-grow-1"
                        style="padding-top: 4px; padding-bottom: 4px;">Play</a>
                    <a href="{% url 'breathxapp:delete_exercise' exercise.id %}"
                        class="text-danger text-center"
                        title="Delete"
                        onclick="return confirm('Are you sure you want to delete this exercise?')"
                        style="font-size: 18px; padding: 4px 6px; border-radius: 6px; transition: background 0.2s;"
                        onmouseover="this.style.background='
#ffdddd'" onmouseout="this.style.background='transparent'">
                        <i class="fas fa-trash-alt"></i>
                    </a>
                </div>
            </div>
        </div>
    </div>
    {% empty %}
    <p class="text-center text-muted">No saved exercises found.</p>
    {% endfor %}
</div>
<script>
document.addEventListener('DOMContentLoaded', function () {
  // Create toast container if not already there
  let toast = document.createElement('div');
  toast.id = 'star-toast';
  toast.style.position = 'fixed';
  toast.style.top = '20px';
  toast.style.right = '20px';
  toast.style.background = '#2196f3';
  toast.style.color = '#fff';
  toast.style.padding = '10px 18px';
  toast.style.borderRadius = '10px';
  toast.style.fontSize = '15px';
  toast.style.boxShadow = '0 4px 12px rgba(0, 0, 0, 0.2)';
  toast.style.zIndex = '9999';
  toast.style.display = 'none';
  toast.style.opacity = '0';
  toast.style.transform = 'translateY(-20px)';
  toast.style.transition = 'opacity 0.4s ease, transform 0.4s ease';
  document.body.appendChild(toast);

  function showToast(message) {
    toast.textContent = message;
    toast.style.display = 'block';
    // Animate in
    setTimeout(() => {
      toast.style.opacity = '1';
      toast.style.transform = 'translateY(0)';
    }, 10);

    // Animate out
    setTimeout(() => {
      toast.style.opacity = '0';
      toast.style.transform = 'translateY(-20px)';
    }, 1800);

    setTimeout(() => {
      toast.style.display = 'none';
    }, 2200);
  }

  document.querySelectorAll('.star-form').forEach(form => {
    const button = form.querySelector('button');
    const id = form.getAttribute('data-id');
    const csrfToken = form.querySelector('[name=csrfmiddlewaretoken]').value;

    button.addEventListener('click', function (e) {
      e.preventDefault();

      fetch(`/breathxapp/star/exercise/${id}/`, {
        method: 'POST',
        headers: {
          'X-CSRFToken': csrfToken,
        },
      })
      .then(res => res.json())
      .then(data => {
        if (data.success) {
          button.innerHTML = data.starred
            ? '<i class="fas fa-star me-2" style="color: gold;"></i>'
            : '<h4>☆</h4>';

          showToast(data.starred ? '⭐ Exercise starred' : '☆ Exercise unstarred');
        }
      })
      .catch(err => {
        console.error('Star save failed', err);
        showToast('❌ Error saving star');
      });
    });
  });
});
</script>

<script>
document.addEventListener('DOMContentLoaded', function () {
  const toggleBtn = document.getElementById('toggleStarredBtn');
  let showingStarred = false;

  toggleBtn.addEventListener('click', function () {
    const allItems = document.querySelectorAll('#exerciseList .activity-item');
    showingStarred = !showingStarred;

    allItems.forEach(item => {
      const starBtn = item.querySelector('.star-toggle-btn');

      // ✅ Get the current star state from the icon instead of stale data attribute
      const isStarred = starBtn.querySelector('i.fas.fa-star') !== null;

      if (showingStarred && !isStarred) {
        item.style.display = 'none';
      } else {
        item.style.display = '';
      }
    });

    toggleBtn.innerHTML = showingStarred
      ? '<i class="fas fa-list me-2"></i> Show All'
      : '<i class="fas fa-star me-2"></i> Starred';
  });
});
</script>






                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    function filterExercises() {
        let searchQuery = document.getElementById("searchInput").value.toLowerCase();
        let exercises = document.querySelectorAll(".activity-item");

        exercises.forEach(exercise => {
            let exerciseName = exercise.getAttribute("data-name");
            let matchesSearch = exerciseName.includes(searchQuery);
            exercise.style.display = matchesSearch ? "block" : "none";
        });
    }
</script>

    <!-- For activity Page ----------------------------------------------- -->
     <script>
    let startTime = Date.now();

    window.addEventListener("beforeunload", function () {
        let duration = Math.round((Date.now() - startTime) / 1000);

        navigator.sendBeacon("/activityapp/track-activity/", JSON.stringify({
            url: window.location.pathname,
            duration: duration
        }));
    });
</script>
<style>
    @media (max-width: 500px) {
  .activity-icon {
    display: none;
  }
  .icon-orbit{
    display: none;
  }
}
@media (max-width: 500px) {
    /* Make form and select take full width */
    form {
        width: 100% !important;
    }

    form select {
        width: 100% !important;
        display: block;
    }

    /* Make buttons split 50% width on same line */
    #list-buttons {
        flex-wrap: nowrap !important;
        width: 100%;
        gap: 10px;
    }

    #list-buttons a {
        width: 50% !important;
        min-width: 0;
        margin-right: 0 !important;
    }
}
</style>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
{% endblock %}
